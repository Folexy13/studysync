<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Gemini API Key - StudySync</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        .api-key-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .api-key-display {
            font-family: monospace;
            background: #fff;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            word-break: break-all;
            margin: 10px 0;
        }

        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f0f8ff;
            border-radius: 10px;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s;
        }

        button:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }

        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
        }

        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
            min-height: 100px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.green {
            background: #28a745;
        }

        .status-indicator.red {
            background: #dc3545;
        }

        .status-indicator.yellow {
            background: #ffc107;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ Gemini API Key Tester for StudySync</h1>
        
        <div class="api-key-section">
            <h2>üìã Your API Key</h2>
            <div class="api-key-display" id="api-key-display">
                AIzaSyAvl2p-wW20plRkb6EZgVCCgX-PuV1JK7o
            </div>
            <p><strong>Status:</strong> <span id="key-status">Ready to test</span></p>
        </div>

        <div class="test-section">
            <h2>üß™ Quick API Test</h2>
            <p>This will test if your API key is working correctly:</p>
            <br>
            <button onclick="testBasicAPI()">Test Basic API Call</button>
            <button onclick="testAllOperations()">Test All Operations</button>
            <button onclick="checkQuota()">Check API Quota</button>
            <div id="test-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h2>üéØ Test Specific Operations</h2>
            <textarea id="test-text" placeholder="Enter text to test with...">The Google Chrome Built-in AI Challenge 2025 is an exciting opportunity for developers to create innovative web applications using Chrome's new AI capabilities, including Gemini Nano. This hackathon encourages participants to build extensions that leverage local AI processing for enhanced privacy and performance.</textarea>
            
            <div class="test-grid">
                <button onclick="testOperation('summarize')">Test Summarize</button>
                <button onclick="testOperation('translate')">Test Translate</button>
                <button onclick="testOperation('questions')">Test Questions</button>
                <button onclick="testOperation('flashcards')">Test Flashcards</button>
                <button onclick="testOperation('proofread')">Test Proofread</button>
                <button onclick="testOperation('explain')">Test Explain</button>
            </div>
            
            <div id="operation-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h2>üîß Integration Test</h2>
            <p>Test the complete hybrid system with your extension:</p>
            <button onclick="testHybridSystem()">Test Hybrid AI Manager</button>
            <button onclick="generateTestCode()">Generate Integration Code</button>
            <div id="integration-result" class="result" style="display:none;"></div>
        </div>

        <div class="test-section">
            <h2>‚ùì Troubleshooting</h2>
            <div id="troubleshooting" class="result info">
                <strong>Common Issues:</strong>
                
                1. <strong>API Key Invalid:</strong>
                   - Make sure you've enabled the Gemini API in Google Cloud Console
                   - Check that the key hasn't been regenerated
                   - Ensure no extra spaces in the key
                
                2. <strong>Quota Exceeded:</strong>
                   - Free tier: 60 requests per minute
                   - Wait a minute and try again
                
                3. <strong>CORS Errors:</strong>
                   - This test page makes direct API calls
                   - In your extension, use the background script
                
                4. <strong>Network Issues:</strong>
                   - Check your internet connection
                   - Try disabling VPN/proxy
                   - Check if googleapis.com is accessible
            </div>
        </div>
    </div>

    <script>
        const API_KEY = 'AIzaSyAvl2p-wW20plRkb6EZgVCCgX-PuV1JK7o';
        const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';

        // Test basic API call
        async function testBasicAPI() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.innerHTML = '<span class="loading"></span> Testing API key...';

            try {
                const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: 'Say "Hello, StudySync!" if this API key is working.'
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.1,
                            maxOutputTokens: 50
                        }
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    const text = data.candidates[0].content.parts[0].text;
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `‚úÖ <strong>API Key is WORKING!</strong>\n\nResponse: ${text}\n\nYour API key is valid and functioning correctly.`;
                    document.getElementById('key-status').innerHTML = '<span class="status-indicator green"></span>Active and Working';
                } else {
                    throw new Error(data.error?.message || 'API request failed');
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå <strong>API Key Test Failed</strong>\n\nError: ${error.message}\n\n${getErrorSolution(error.message)}`;
                document.getElementById('key-status').innerHTML = '<span class="status-indicator red"></span>Error - See below';
            }
        }

        // Test specific operation
        async function testOperation(operation) {
            const resultDiv = document.getElementById('operation-result');
            const text = document.getElementById('test-text').value;
            
            if (!text) {
                alert('Please enter some text to test with');
                return;
            }

            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.innerHTML = `<span class="loading"></span> Testing ${operation}...`;

            const prompts = {
                summarize: `Summarize this text in 2-3 sentences: ${text}`,
                translate: `Translate this to Spanish: ${text}`,
                questions: `Generate 3 study questions from this text: ${text}`,
                flashcards: `Create 3 flashcards from this text. Format: Q: [question] | A: [answer]\n\nText: ${text}`,
                proofread: `Proofread and correct any errors in this text: ${text}`,
                explain: `Explain this in simple terms for a beginner: ${text}`
            };

            try {
                const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompts[operation]
                            }]
                        }],
                        generationConfig: {
                            temperature: 0.7,
                            maxOutputTokens: 500
                        }
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    const result = data.candidates[0].content.parts[0].text;
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `‚úÖ <strong>${operation.toUpperCase()} Test Successful!</strong>\n\n${result}`;
                } else {
                    throw new Error(data.error?.message || 'Operation failed');
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `‚ùå <strong>${operation} Failed</strong>\n\nError: ${error.message}`;
            }
        }

        // Test all operations
        async function testAllOperations() {
            const operations = ['summarize', 'questions', 'explain'];
            const resultDiv = document.getElementById('test-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            
            let results = 'üß™ <strong>Testing All Operations:</strong>\n\n';
            
            for (const op of operations) {
                resultDiv.innerHTML = results + `<span class="loading"></span> Testing ${op}...`;
                
                try {
                    const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: `Test ${op} operation: Hello World`
                                }]
                            }],
                            generationConfig: {
                                temperature: 0.1,
                                maxOutputTokens: 50
                            }
                        })
                    });

                    if (response.ok) {
                        results += `‚úÖ ${op}: Working\n`;
                    } else {
                        results += `‚ùå ${op}: Failed\n`;
                    }
                } catch (error) {
                    results += `‚ùå ${op}: Error - ${error.message}\n`;
                }
                
                // Small delay between requests
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            resultDiv.className = 'result success';
            resultDiv.innerHTML = results + '\n‚úÖ All tests completed!';
        }

        // Check API quota
        async function checkQuota() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            
            resultDiv.innerHTML = `üìä <strong>API Quota Information:</strong>

<strong>Free Tier Limits:</strong>
‚Ä¢ 60 requests per minute (RPM)
‚Ä¢ 1 million tokens per month
‚Ä¢ No credit card required

<strong>Current Time:</strong> ${new Date().toLocaleString()}

<strong>To check your usage:</strong>
1. Visit: https://console.cloud.google.com/apis/api/generativelanguage.googleapis.com
2. Click on "Metrics" or "Quotas"
3. View your current usage

<strong>Tips:</strong>
‚Ä¢ Implement caching to reduce API calls
‚Ä¢ Use shorter prompts when possible
‚Ä¢ Batch operations when feasible`;
        }

        // Test hybrid system
        async function testHybridSystem() {
            const resultDiv = document.getElementById('integration-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            
            resultDiv.innerHTML = `üîÑ <strong>Testing Hybrid AI System:</strong>\n\n`;
            
            // Simulate hybrid system test
            const tests = [
                { name: 'Chrome Built-in AI', available: typeof ai !== 'undefined' },
                { name: 'Gemini API Fallback', available: true },
                { name: 'Basic Processing', available: true }
            ];
            
            let results = '';
            for (const test of tests) {
                if (test.name === 'Chrome Built-in AI') {
                    if (test.available) {
                        try {
                            const caps = await ai.languageModel.capabilities();
                            results += `‚úÖ ${test.name}: ${caps.available}\n`;
                        } catch (e) {
                            results += `‚ùå ${test.name}: Not available\n`;
                        }
                    } else {
                        results += `‚ùå ${test.name}: Not detected\n`;
                    }
                } else if (test.name === 'Gemini API Fallback') {
                    // Test Gemini
                    try {
                        const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: 'test' }] }],
                                generationConfig: { maxOutputTokens: 10 }
                            })
                        });
                        results += response.ok ? `‚úÖ ${test.name}: Working\n` : `‚ùå ${test.name}: Failed\n`;
                    } catch (e) {
                        results += `‚ùå ${test.name}: Error\n`;
                    }
                } else {
                    results += `‚úÖ ${test.name}: Always available\n`;
                }
            }
            
            resultDiv.className = 'result success';
            resultDiv.innerHTML = `<strong>Hybrid System Status:</strong>\n\n${results}\n\n‚úÖ Your extension will work using the available methods!`;
        }

        // Generate integration code
        function generateTestCode() {
            const resultDiv = document.getElementById('integration-result');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            
            const code = `// Add this to your background/service-worker.js

// Store the API key
chrome.storage.sync.set({ 
    geminiApiKey: '${API_KEY}' 
});

// Test code for your extension
async function testGeminiIntegration() {
    const API_KEY = '${API_KEY}';
    const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';
    
    try {
        const response = await fetch(\`\${API_URL}?key=\${API_KEY}\`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                contents: [{
                    parts: [{
                        text: 'Summarize: Chrome AI is amazing!'
                    }]
                }],
                generationConfig: {
                    temperature: 0.7,
                    maxOutputTokens: 100
                }
            })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            console.log('‚úÖ Gemini API working:', data.candidates[0].content.parts[0].text);
            return true;
        } else {
            console.error('‚ùå Gemini API error:', data.error);
            return false;
        }
    } catch (error) {
        console.error('‚ùå Network error:', error);
        return false;
    }
}

// Run the test
testGeminiIntegration();`;
            
            resultDiv.innerHTML = `<strong>üìã Integration Code (Copy this to your extension):</strong>\n\n${code}\n\n<strong>Instructions:</strong>
1. Copy the code above
2. Add it to your service-worker.js
3. Reload your extension
4. Check the console for results`;
        }

        // Get error solution
        function getErrorSolution(error) {
            if (error.includes('API key not valid')) {
                return `<strong>Solution:</strong>
1. Check if you copied the key correctly
2. Regenerate the key at https://makersuite.google.com/app/apikey
3. Make sure the Gemini API is enabled for your project`;
            } else if (error.includes('quota')) {
                return `<strong>Solution:</strong>
You've exceeded the free tier limit (60 requests/minute).
Wait a minute and try again.`;
            } else if (error.includes('network')) {
                return `<strong>Solution:</strong>
1. Check your internet connection
2. Disable VPN/proxy if using one
3. Try again in a few moments`;
            } else {
                return `<strong>Solution:</strong>
1. Try regenerating your API key
2. Check the browser console for more details
3. Contact support if the issue persists`;
            }
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            console.log('Gemini API Tester loaded');
            console.log('API Key:', API_KEY);
        });
    </script>
</body>
</html>